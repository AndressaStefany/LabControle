% Relatório da versão 1 do software ipump para o curso
% Sistemas de Controle - DCA0206 - UFRN
% Autores:
%   AUGUSTO MATHEUS PINHEIRO DAMASCENO
%   MARCEL DA CÂMARA RIBEIRO DANTAS
%   PABLO HOLANDA CARDOSO
%   PEDRO DE CASTRO GURGEL LIMA
%   RODRIGO DANTAS DA SILVA
% Modificado por: Ícaro Bezerra Queiroz de Araújo
%

%%%%%%%%%%%% STRUCTURE %%%%%%%%%%%%%%%
\documentclass[a4paper,12pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[brazil]{babel}
\usepackage{lmodern}
\usepackage{setspace}
\usepackage[top=2cm, bottom=2cm, left=2cm, right=2cm]{geometry}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%% PAGES STYLE %%%%%%%%%
\usepackage{fancyhdr}
\fancypagestyle{main}{
\renewcommand{\headrulewidth}{0pt}
\fancyhead[RO]{\thepage}
\fancyfoot[CO]{}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{graphicx}
\usepackage{float}
\usepackage{epstopdf}
\usepackage{subfig}
\usepackage{mathptmx}
\usepackage{changepage}

\usepackage{listings}
\usepackage{xcolor}
\lstset{language=C++,
                basicstyle=\ttfamily,
                keywordstyle=\color{blue}\ttfamily,
                stringstyle=\color{red}\ttfamily,
                commentstyle=\color{green}\ttfamily,
                morecomment=[l][\color{magenta}]{\#}
}

%\usepackage[alf]{abntex2cite}

%%%%%%%%%%% PDF METADATA %%%%%%%%%%%%%
\usepackage[ pdftitle={MODELO RELATÓRIO},
pdfsubject={INTRODUÇÃO AO LABORATÓRIO DE CONTROLE - Grupo 3},
pdfkeywords={Controle,Automação,UFRN,DCA,ipump},
hidelinks]{hyperref}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\onehalfspacing

\thispagestyle{empty}

\setcounter{page}{1}

%%%%%%%%%%%% LOGOS %%%%%%%%%%%%%%%%%%%

\begin{figure}[!ht]

\centering

\subfloat{
\includegraphics[width=2.7cm]{UFRN.eps}
\label{UFRN Logo}
}
\hspace{11.09cm}
\subfloat{
\includegraphics[width=2.4cm]{DCA.eps}
\label{DCA Logo}
}

%\caption{}
\label{Logos}

\end{figure}

%%%%%%%%%%%%%%% CAPA %%%%%%%%%%%%%%%%%

\vspace{-1cm}

\begin{center}
{\bf{\normalsize UNIVERSIDADE FEDERAL DO RIO GRANDE DO NORTE\\
CENTRO DE TECNOLOGIA\\
DEPARTAMENTO DE ENGENHARIA DE COMPUTAÇÃO E AUTOMAÇÃO\\
CURSO DE ENGENHARIA DE COMPUTAÇÃO
}}


\vspace{3.6cm}

{\bf{\large RELATÓRIO DA 1ª EXPERIÊNCIA\\
INTRODUÇÃO AO LABORATÓRIO DE CONTROLE\\
}}
\vspace{1.5cm}
{\large TURMA: 01 A\\
	GRUPO Nº}

\vspace{3.6cm}



\begin{flushright}
\begin{normalsize}
ANDRESSA STÉFANY SILVA DE OLIVEIRA: 20160154101\\
\vspace{0.8cm}
FERNANDA MONTEIRO DE ALMEIDA: 20160154228\\
\vspace{0.8cm}
VITOR RAMOS GOMES DA SILVA: 20160154415\\
\vspace{0.8cm}
MÁRCIO LUIZ BEZERRA LOPES JÚNIOR: 20160154326\\
\end{normalsize}
\end{flushright}


\vspace{2.5cm}

{\large Natal-RN\\
2017}

\end{center}

\newpage

%%%%%%%%%%%%%%%  CONTRA-CAPA %%%%%%%%%

\thispagestyle{empty}

\begin{center}
\begin{normalsize}
ANDRESSA STÉFANY SILVA DE OLIVEIRA: 2016015410\\
\vspace{0.8cm}
FERNANDA MONTEIRO DE ALMEIDA 20160154228\\
\vspace{0.8cm}
VITOR RAMOS GOMES DA SILVA: 20160154415\\
\vspace{0.8cm}
MÁRCIO LUIZ BEZERRA LOPES JÚNIOR: 20160154326\\

\end{normalsize}
\end{center}
\vspace{3cm}

{\bf{\large {\centering INTRODUÇÃO AO LABORATÓRIO DE CONTROLE\\}}}

\vspace{4cm}

\begin{adjustwidth}{7.5cm}{0cm}

{\normalsize

Primeiro Relatório Parcial apresentado à disciplina de
Laboratório de Sistemas de Controle, correspondente à
avaliação da 1º unidade do semestre 2017.1 do 8º período
do curso de Engenharia de Computação da
Universidade Federal do Rio Grande do Norte, sob
orientação do {\bf Prof. Fábio Meneghetti Ugulino de
Araújo.}

}

\end{adjustwidth}

\vspace{2cm}

\begin{center}

Professor:  Fábio Meneghetti Ugulino de Araújo.

\vspace{2.5cm}

{\large Natal-RN\\
2017}

\end{center}

\newpage

%%%%%%%%%%%%%%%  RESUMO %%%%%%%%%%%%%%

\thispagestyle{empty}

\begin{center}
{\large \textbf{RESUMO}}
\end{center}

\vspace{3cm}

\begin{flushleft}

\hspace{4ex}O presente trabalho é referente ao desenvolvimento de um software que se comunica com um sistema de tanques, uma planta Quanser, e seu simulador, o qual possui canais para leitura e escrita de sinais. Primeiro, houve a análise matemática das relações entre vazão de entrada, vazão de saída, tensão enviada para a bomba e o nível de água presente no tanque. Além disso, o sistema possui duas situações: malha aberta, a qual o usuário escolhe a tensão a ser enviada; e malha fechada, nesse caso, o usuário indica exatamente o nível que a água deve estar. O usuário também escolhe o tipo de sinal que está sendo enviado (degrau, onda quadrada, entre outros). Posteriormente, fazendo uso de dados adquiridos experimentalmente, obteve as equações referente ao comportamento do fluxo da água com relação à bomba, como também, a associação da altura com a tensão. O comportamento do sistema é informado para o usuário através de gráficos presentes na interface do software, tanto o sinal de entrada escolhido como os valores que são lidos nos canais indicados pelo usuário.\\

\end{flushleft}

\vspace{1.5cm}

\textbf{Palavras-chave:} sistema de tanques; sistema de controle; software; planta Quanser.

\newpage

%%%%%%%%% LISTA DE FIGURAS %%%%%%%%%%%

\thispagestyle{empty}

\begin{center}
\listoffigures
\end{center}

\newpage

%%%%%%%%%%%%%%% SUMÁRIO %%%%%%%%%%%%%%

\thispagestyle{empty}

\begin{center}
\tableofcontents
\end{center}

\newpage

%%%%%%%%%%%%%%% INTRODUÇÃO %%%%%%%%%%%

\thispagestyle{main}

\section{INTRODUÇÃO}

\begin{flushleft}
\hspace{4ex}O trabalho descrito neste relatório tem como objetivo o desenvolvimento de uma aplicação capaz de manipular um sistema de tanques Quanser através da utilização da linguagem C++.

A aplicação deve ser capaz de controlar o nível no tanque superior de acordo com a orientação dada pelo usuário. O usuário define a tensão da bomba em volts (para o caso de malha aberta) ou o nível a ser atingido no tanque em centímetros (para o caso de malha fechada), sendo estabelecidos limites na aplicação respeitando os limites físicos do tanque e da bomba. A aplicação deverá realizar esse controle utilizando-se de cinco tipos de sinais: degrau, onda senoidal, onda quadrada, onda do tipo dente de serra, e aleatória. O usuário definirá também as portas de entrada e saída, podendo escolher de uma a oito portas de saída.

Através das equações de vazão, pretende-se achar uma relação entre a tensão aplicada pela bomba e nível de água no tanque, de forma que o nível varie o mínimo possível. A partir dessa relação serão desenvolvidas as funções referentes aos cinco tipos de sinais.

O resultado será apresentado através de uma interface gráfica, onde o usuário, além de controlar a situação, poderá visualizar as variações ocorrentes nas portas de saída em plano cartesiano, incluindo os níveis nos dois tanques e a tensão na bomba.
\end{flushleft}

\newpage

%%%%%%%%%% REFERENCIAL TEÓRICO %%%%%%%

\thispagestyle{main}

\section{REFERENCIAL TEÓRICO}

\subsection{LUGAR GEOMÉTRICO DAS RAÍZES}
\hspace{4ex}Lugar geométrico das raízes é a representação gráfica dos lugares dos pólos e zeros da função de transferência de malha fechada quando os paramêtros da função, também chamado de ganho, são variados de zero a infinito.
 
%\[ \frac{k_m}{A}u(t)= \frac{a\sqrt{2gh(t)}}{A} \]
%\[ u(t)=  \frac{a\sqrt{2gh(t)}}{k_m}\]
Pode se obter esses lugares através da função de transferência de malha fechada do sistema:
\begin{equation}\label{eq:1}
1 + kG(s)H(s) = 0
\end{equation}

\subsection{CONTROLADOR DE TRÊS TERMOS (PID)}
O controlador PID é o mais utilizado na indústria (DorfBishop, 2009) um dos motivos para que isso ocorra é devido a facilidade de ser controlado no local. Além disso, é amplamente discutido na literatura, com várias publicações de ajustes e ajustes finos (Ogata, 2010). PID modificados como o PI-D também é bastante utilizado. Pode também ser usado em situações em que não se conhece a função de transferência sistema e ainda conseguir um bom resultado. Porém há ressalvas e em alguns sistemas pode se não obter um controle ótimo.

O PID tem como função de transferência a seguinte expressão:

\begin{equation}\label{eq:1}
G_c(s) = K_p + \frac{K_I}{s} + K_D s
\end{equation}

Na equação podemos ver três parâmetros. Quando se atribui zero ao parâmetro derivativo, obtém-se o controlador PI, controlador proporcional e integral:  \[K_D = 0 \] 
Logo, \[G_c(s) = K_p + \frac{K_I}{s} \]
Da mesma forma para o parâmetro da integral:
\[K_I = 0 \] 
Tem-se o controlador proporcional derivativo, ou PD: \[G_c(s) = K_p + K_D s \]

\begin{figure}[!h]
\centering
\includegraphics[scale=1]{controlador-malha-fechada.jpg}
\caption{Sistema de malha fechada com controlador}
\label{fig:sistema}
{Fonte: DorfBishop, 2009}
\end{figure}

A função de transferência do PID insere no sistema uma pólo na origem e dois zeros em lugares a serem determinados. Se for adicionado zeros complexos no sistema, têm-se um lugar geométrico das raízes como o exemplo a seguir: 

\begin{figure}[!h]
\centering
\includegraphics[scale=1]{lugar-das-raizes-pid.jpg}
\caption{Lugar das raízes com zeros complexos}
\label{fig:lgr}
{Fonte: DorfBishop, 2009}
\end{figure}


\subsection{EFEITOS DO CONTROLE DERIVATIVO E INTEGRAL NA PERFORMANCE DO SISTEMA}
\hspace{4ex}
Para um sistema com controle apenas proporcional, dada uma entrada degrau, o erro de regime estacionário aparecerá. Esse offset dependerá do ganho proporcional atribuído. Para que seja eliminado esse erro é necessário a adição de um controlador integral, já que ele adiciona um zero ao sistema, mas pode deixar o sistema mais oscilatório.

Já o controle derivativo quando adicionado a um controle proporcional (PD), oferece um controle com alta sensibilidade, devido a responder a taxa de variação do erro, dessa forma o controle atua antes de forma preventiva (Ogata, 2010). Esse tipo de controle não corrige diretamento o erro de regime estacionário, mas adiciona amortecimento ao sistema de forma que permite um uso de um ganho maior.

Portanto, tendo em mente os efeitos e peculiaridades de cada controlador, pode-se projetar um PID mais eficiente.
\newpage

%%%%%%%%%% METODOLOGIA %%%%%%%%%%%%%%%

\thispagestyle{main}

\section{METODOLOGIA}

\hspace{4ex}O sistema de controle Proporcional Integral Derivativo (PID) desenvolvido foi implementado no código de acordo com o referencial teórico. Para isso, foi criado uma classe que de acordo com a solicitação do usuário será: apenas Proporcional (P), ou Proporcional Integrativo (PI), ou Proporcional Derivativo (PD), ou PID, ou PI-D. A implementação pode ser observada abaixo:

\begin{lstlisting}
double PID::Controle(double e, double h)
{
    I= I+Ki*e*h;
    D= Kd*(e-e_ant)/h;
    e_ant= e;
    return Kp*e+I+D;
}

double PID::Controle(double e, double y, double h)
{
    I= I+Ki*e*h;
    D= Kd*(y-e_ant)/h;
    e_ant= y;
    return Kp*e+I+D;
}
\end{lstlisting}

\hspace{4ex}O primeiro método é referente ao P, PI, PD e PID, enquanto que o segundo método é o PI-D.
\hspace{4ex}Após essa implementação, foram feitos vários testes utilizando todos os tipos de controladores, como também, variando os ganhos.

\newpage

%%%%%%%%%% RESULTADOS %%%%%%%%%%%%%%%

\thispagestyle{main}

\section{RESULTADOS}

\hspace{4ex}

\subsection{Programa de controle}
O sistema no geral não apresentou problemas de conexão com o servidor, como perda de conexão ou atrasos consideráveis nos dados recebidos. Para o caso de não paralelizar a leitura e escrita de dados, foi observada que não houve influencia negativa observável, como na vazão de entrada, a bomba era iniciada quase que instantaneamente. Os dados recebidos dos sensores que representavam o nível estavam bem próximos do valor real, tendo em casos uma diferença em média de mais ou menos um centímetro. 

A figura a seguir mostra uma visão geral do programa desenvolvido.

%%% Problemas para inserir figuras %%%
\begin{figure}[!h]
\centering
\includegraphics[width=0.9\textwidth]{prog-geral.eps}
\caption{Interface do programa de controle}
\label{Interface}
\end{figure}
\hspace{4ex}
Onde o gráfico principal que está localizado no canto inferior esquerdo apresenta o sinal enviado em tempo real. Os outros quatro gráficos à direita do gráfico principal apresentam as leituras dos possíveis oito canais disponíveis na placa. Entretanto, apenas dois obtinham informação relevante. No canal 0, a leitura do nível do tanque 1 e, no canal 1, a leitura do nível do tanque 2.


%\subsubsection{Subseções}

\newpage
\subsection{Sistema de tanques}
\hspace{4ex}
Pode-se observar através das leituras dos sensores como se deu o comportamento do nível dos tanques. Quando escolhido a malha aberta, a saída segue a entrada e se os dados recebidos não estiverem de acordo com a referência, só poderá ser corrigido quando a entrada é alterada. Dessa forma, o ajuste é feito manualmente. 

\begin{figure}[!h]
\centering
\includegraphics[width=0.8\textwidth]{maberta-sen-4.eps}
\caption{Sistem de controle para malha aberta com entrada senoidal}
\label{Entrada Senoidal - aberta}
\end{figure}
  
Na imagem acima pode-se ver que a resposta do sistema está deslocada em relação ao sinal de entrada. Enquanto a entrada está no seu ponto mínimo, na resposta o sinal está logo após o pico. 

\begin{figure}[!h]
\centering
\includegraphics[width=0.8\textwidth]{maberta-serra-4.eps}
\caption{Sistem de controle para malha aberta com entrada dente de serra}
\label{Entrada Dente de Serra - aberta}
\end{figure}

\newpage
Já observando a resposta a um sinal dente de serra na figura 6, quando há a mudança brusca de valor quando se alcança a amplitude determinada na entrada, vê-se que o nível não segue o mesmo ritmo de mudança. O nível desce lentamente e dependendo do período, pode-se manter um certo nível.

Para o caso de malha fechada, o sistema vai tentar compensar o erro da referência. É o que se pode notar nos gráficos de saída. A figura 7 mostra que para uma entrada degrau em que a referência é 20cm, o sistema envia a tensão de 4 volts, ou seja, tensão máxima. O tanque alcança o nível, então para se manter no valor de referência, a tensão converge lentamente para uma tensão de equlíbrio.

\begin{figure}[!h]
\centering
\includegraphics[width=0.8\textwidth]{mfechada-degrau-20.eps}
\caption{Sistem de controle para malha fechada com entrada degrau}
\label{Entrada Degrau - fechada}
\end{figure}

Quando se transmite o dente de serra, observa que o sinal de entrada perde suas características, como se pode ver na figura 8, o gráfico principal não tem mais um subida rápida e linear. Porém, na saída, notou-se que o nível não permanecia constante, o nível se assemelhava a função dente de serra com uma subida mais lenta e com descida rápida, mas não brusca.  

Por fim, tem-se o caso do sinal aleatório para malha fechada em que o sinal de referência está  mudando rapidamente. Dessa forma, fica mais difĩcil de analisar o controle, já que não se consegue convergir em um valor ou um comportamento fixo. Na figura 9 se pode notar que tensões negativas e próximas de zero, considerando que o nível do tanque era alto antes de mudar para o sinal aleatório, viu-se que o nível rapidamente desceu. Logo, para um sinal aleatório a média fica em torno de zero, por isso o tanque não sobe muito. Há pequenas mudanças mas nada que se sutenta. O gráfico de saída ficou mais incostante como se tivessem pequenas pertubações no tanque.

\newpage

\begin{figure}[!h]
\centering
\includegraphics[width=0.8\textwidth]{mfechada-serra-15.eps}
\caption{Sistem de controle para malha fechada com dente de serra}
\label{Entrada Dente de serra - fechada}
\end{figure}

\begin{figure}[!h]
\centering
\includegraphics[width=0.8\textwidth]{mfechada-rand.eps}
\caption{Sistem de controle para malha fechada com aleatória}
\label{Entrada aleatória - fechada}
\end{figure}



\newpage

%%%%%%%%%% CONCLUSÃO %%%%%%%%%%%%%%%

\thispagestyle{main}

\section{CONCLUSÃO}


\hspace{4ex}De acordo com os resultados obtidos, pode-se concluir que na malha fechada, o controlador consegue rastrear bem o degrau, para os demais sinais, esse rastreamento só é possível se a variação do sinal for mais lenta que a constante de tempo do sistema. Enquanto que na malha aberta, é importante ressaltar que o sinal dificilmente ficará no valor calculado teoricamente, devido a interferência de fatores externos e internos, como por exemplo a temperatura, funcionamento da bomba e ajustes dos sensores da planta.

Além disso, o controlador utilizado na malha fechada calcula o erro do nível do tanque e soma com a tensão necessária para chegar na altura desejada pelo usuário, dessa forma, o erro faz o papel de acelerador do sistema, fazendo com que um determinado nível seja alcançado rapidamente, diferentemente do caso em que se utiliza apenas o valor do erro onde o valor desejado pode não ser alcançado.

\newpage

%%%%%%%% REFERÊNCIAS %%%%%%%%%%%%%%%%%

%Referências bibliogáficas (geradas automaticamente)
\addcontentsline{toc}{chapter}{Referências bibliográficas}
\bibliography{bib/bibliografia}

\appendix

%Apêndice A
\include{apendice}

\end{document}
